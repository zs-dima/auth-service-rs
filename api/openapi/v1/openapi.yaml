openapi: 3.1.0
info:
  title: Auth Service API
  description: Authentication and user management gRPC/REST API
  version: 0.1.0
  contact:
    name: Auth Service
    url: https://github.com/zs-dima/auth-service-rs
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
paths:
  /health/live:
    get:
      tags:
      - OperationsService
      description: |-
        Kubernetes liveness probe.

         Returns plain text "OK" when the process is alive.
      operationId: OperationsService_LivenessCheck
      responses:
        '200':
          description: OK
          content:
            text/plain:
              schema:
                type: string
              example: OK
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      security: []
      summary: Kubernetes liveness probe
  /health/ready:
    get:
      tags:
      - OperationsService
      description: |-
        Kubernetes readiness probe with dependency health checks.

         Returns JSON with database and S3 storage connectivity status.
      operationId: OperationsService_ReadinessCheck
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/operations.v1.HealthResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/operations.v1.HealthResponse'
      security: []
      summary: Kubernetes readiness probe with dependency health checks
  /metrics:
    get:
      tags:
      - OperationsService
      description: |-
        Prometheus metrics endpoint.

         Returns Prometheus text exposition format when metrics collection is
         enabled. Content-Type: text/plain; version=0.0.4; charset=utf-8
      operationId: OperationsService_Metrics
      responses:
        '200':
          description: OK
          content:
            text/plain:
              schema:
                type: string
          headers:
            Content-Type:
              description: Prometheus text exposition media type.
              schema:
                type: string
                default: text/plain; version=0.0.4; charset=utf-8
            Cache-Control:
              description: Caching policy for metrics responses.
              schema:
                type: string
                default: no-store, no-cache, max-age=0
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      security: []
      summary: Prometheus metrics endpoint
  /v1/auth/authenticate:
    post:
      tags:
      - AuthService
      description: |-
        Authenticate with identifier (email or phone) and password
         Returns AuthResult with tokens on success, or error status with lockout
         info
      operationId: AuthService_Authenticate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.AuthenticateRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.AuthResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      security: []
      summary: Authenticate with identifier (email or phone) and password
  /v1/auth/credentials:
    get:
      tags:
      - AuthService
      description: Validate current session/credentials
      operationId: AuthService_ValidateCredentials
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.ValidateCredentialsResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      summary: Validate current session/credentials
  /v1/auth/mfa/disable:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Disable MFA (requires password verification)
      operationId: AuthService_DisableMfa
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.DisableMfaRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/mfa/setup:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Begin MFA setup (returns secret/challenge based on method)
      operationId: AuthService_SetupMfa
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.SetupMfaRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.SetupMfaResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/mfa/setup/confirm:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Confirm MFA setup with verification code
      operationId: AuthService_ConfirmMfaSetup
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.ConfirmMfaSetupRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.ConfirmMfaSetupResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/mfa/status:
    get:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Get current MFA status for user
      operationId: AuthService_GetMfaStatus
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.GetMfaStatusResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/mfa/verify:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Complete MFA verification (when Authenticate returns MFA_REQUIRED)
      operationId: AuthService_VerifyMfa
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.VerifyMfaRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.AuthResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      security: []
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/oauth/exchange:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Exchange OAuth callback code for tokens (login or register)
      operationId: AuthService_ExchangeOAuthCode
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.ExchangeOAuthCodeRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.AuthResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      security: []
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/oauth/link:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Link OAuth provider to existing authenticated account
      operationId: AuthService_LinkOAuthProvider
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.LinkOAuthProviderRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/oauth/providers:
    get:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        List linked OAuth providers for current user
      operationId: AuthService_ListLinkedProviders
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.ListLinkedProvidersResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/oauth/providers/{provider}:
    delete:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Unlink OAuth provider from account
      operationId: AuthService_UnlinkOAuthProvider
      parameters:
      - name: provider
        in: path
        required: true
        schema:
          enum:
          - google
          - github
          - microsoft
          - apple
          - facebook
          type: string
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/oauth/url:
    post:
      tags:
      - AuthService
      description: |-
        ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED.

        Get OAuth authorization URL with PKCE state
      operationId: AuthService_GetOAuthUrl
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.GetOAuthUrlRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.GetOAuthUrlResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '501':
          description: Not Implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-not-implemented: true
      security: []
      summary: ⚠️ **Not yet implemented** — returns gRPC UNIMPLEMENTED
  /v1/auth/password/change:
    post:
      tags:
      - AuthService
      description: |-
        Change password (requires current password - OWASP requirement)
         Use RecoveryStart/Confirm if user forgot password or has no password
         For admin password reset without verification, use UserService.SetPassword
      operationId: AuthService_ChangePassword
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.ChangePasswordRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      summary: Change password (requires current password - OWASP requirement)
  /v1/auth/recovery/confirm:
    post:
      tags:
      - AuthService
      description: Confirm recovery with token and set new password
      operationId: AuthService_RecoveryConfirm
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.RecoveryConfirmRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      security: []
      summary: Confirm recovery with token and set new password
  /v1/auth/recovery/start:
    post:
      tags:
      - AuthService
      description: |-
        Start password recovery (always returns success to prevent enumeration)
         Also used by OAuth-only users to add a password to their account
      operationId: AuthService_RecoveryStart
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.RecoveryStartRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      security: []
      summary: Start password recovery (always returns success to prevent enumeration)
  /v1/auth/sessions:
    post:
      tags:
      - AuthService
      description: |-
        List all active sessions for current user
         POST because refresh_token in body must not appear in URLs/logs
      operationId: AuthService_ListSessions
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.ListSessionsRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.ListSessionsResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      summary: List all active sessions for current user
    delete:
      tags:
      - AuthService
      description: Revoke all sessions except current
      operationId: AuthService_RevokeOtherSessions
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.RevokeSessionsResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      summary: Revoke all sessions except current
  /v1/auth/sessions/{deviceId}:
    delete:
      tags:
      - AuthService
      description: Revoke a specific session by device_id
      operationId: AuthService_RevokeSession
      parameters:
      - name: deviceId
        in: path
        required: true
        schema:
          type: string
          minLength: 1
          maxLength: 255
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      summary: Revoke a specific session by device_id
  /v1/auth/signout:
    post:
      tags:
      - AuthService
      description: Sign out and invalidate current session
      operationId: AuthService_SignOut
      summary: Sign out and invalidate current session
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
  /v1/auth/signup:
    post:
      tags:
      - AuthService
      description: |-
        Register a new account
         Returns AUTH_STATUS_SUCCESS with tokens, or AUTH_STATUS_PENDING if
         verification required
      operationId: AuthService_SignUp
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.SignUpRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.AuthResponse'
      security: []
      summary: Register a new account
  /v1/auth/token/refresh:
    post:
      tags:
      - AuthService
      description: Refresh access token using refresh token
      operationId: AuthService_RefreshTokens
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.RefreshTokensRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.TokenPair'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      security: []
      summary: Refresh access token using refresh token
  /v1/auth/verification/confirm:
    post:
      tags:
      - AuthService
      description: Confirm verification with token - returns auth tokens for seamless login
      operationId: AuthService_ConfirmVerification
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.ConfirmVerificationRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/auth.v1.AuthResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      security: []
      summary: Confirm verification with token - returns auth tokens for seamless login
  /v1/auth/verification/request:
    post:
      tags:
      - AuthService
      description: Request verification code for email or phone (resend)
      operationId: AuthService_RequestVerification
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth.v1.RequestVerificationRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      summary: Request verification code for email or phone (resend)
  /v1/users:
    get:
      tags:
      - UserService
      description: |-
        **Streaming (SSE):** Load users (server-streaming).

         Transport behavior:
         - gRPC / gRPC-Web: native server-streaming (built-in reconnection via
         gRPC-Web layer)
         - REST: Server-Sent Events (text/event-stream) via Axum SSE handler.
           Supports EventSource auto-reconnection and Last-Event-ID resume.

         OpenAPI: annotated with `x-streaming: sse` and `x-content-type:
         text/event-stream` by the post-processing step (`make openapi`).
      operationId: UserService_ListUsers
      parameters:
      - name: userId
        in: query
        description: UUID of the user
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
      - name: statuses
        in: query
        description: Filter by account statuses
        schema:
          type: array
          items:
            enum:
            - pending
            - active
            - suspended
            - deleted
            type: string
      - name: roles
        in: query
        description: Filter by roles
        schema:
          type: array
          items:
            enum:
            - admin
            - user
            - guest
            type: string
      - name: query
        in: query
        description: Free-text search query (name, email, phone)
        schema:
          type: string
      - name: pageSize
        in: query
        description: Maximum number of results per page (0 = server default)
        schema:
          type: integer
          format: int32
      - name: pageToken
        in: query
        description: Pagination cursor from a previous response
        schema:
          type: string
      - name: Last-Event-ID
        in: header
        required: false
        description: Reconnection cursor from the last received SSE event. When set, the server resumes the stream from this point.
        schema:
          type: string
      responses:
        '200':
          description: OK
          content:
            text/event-stream:
              schema:
                $ref: '#/components/schemas/users.v1.User'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-streaming: sse
      x-content-type: text/event-stream
      summary: '**Streaming (SSE):** Load users (server-streaming)'
    post:
      tags:
      - UserService
      description: Create a new user
      operationId: UserService_CreateUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/users.v1.CreateUserRequest'
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/users.v1.User'
      summary: Create a new user
  /v1/users/info:
    get:
      tags:
      - UserService
      description: |-
        **Streaming (SSE):** Load user info (server-streaming).

         Transport behavior:
         - gRPC / gRPC-Web: native server-streaming (built-in reconnection via
         gRPC-Web layer)
         - REST: Server-Sent Events (text/event-stream) via Axum SSE handler.
           Supports EventSource auto-reconnection and Last-Event-ID resume.

         OpenAPI: annotated with `x-streaming: sse` and `x-content-type:
         text/event-stream` by the post-processing step (`make openapi`).
      operationId: UserService_ListUsersInfo
      parameters:
      - name: userId
        in: query
        description: UUID of the user
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
      - name: statuses
        in: query
        description: Filter by account statuses
        schema:
          type: array
          items:
            enum:
            - pending
            - active
            - suspended
            - deleted
            type: string
      - name: roles
        in: query
        description: Filter by roles
        schema:
          type: array
          items:
            enum:
            - admin
            - user
            - guest
            type: string
      - name: query
        in: query
        description: Free-text search query (name, email, phone)
        schema:
          type: string
      - name: pageSize
        in: query
        description: Maximum number of results per page (0 = server default)
        schema:
          type: integer
          format: int32
      - name: pageToken
        in: query
        description: Pagination cursor from a previous response
        schema:
          type: string
      - name: Last-Event-ID
        in: header
        required: false
        description: Reconnection cursor from the last received SSE event. When set, the server resumes the stream from this point.
        schema:
          type: string
      responses:
        '200':
          description: OK
          content:
            text/event-stream:
              schema:
                $ref: '#/components/schemas/users.v1.UserInfo'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      x-streaming: sse
      x-content-type: text/event-stream
      summary: '**Streaming (SSE):** Load user info (server-streaming)'
  /v1/verify-email:
    get:
      tags:
      - OperationsService
      description: |-
        Handle email verification link clicks.

         Flow: Email link → GET /v1/verify-email?token=xxx → 302 redirect →
         Frontend. The actual HTTP response is a 302 redirect, not the message body.
      operationId: OperationsService_VerifyEmail
      parameters:
      - name: token
        in: query
        description: Verification token from the email link (URL-encoded).
        schema:
          type: string
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '302':
          description: Redirect to frontend success or error page.
          headers:
            Location:
              description: Frontend success or error page URL.
              required: true
              schema:
                type: string
                format: uri
      security: []
      summary: Handle email verification link clicks
  /v1/users/{user_id}:
    patch:
      tags:
      - UserService
      description: Update user
      operationId: UserService_UpdateUser
      parameters:
      - name: user_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
        description: Resource UUID
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                timezone:
                  type: string
                  description: Timezone (IANA)
                  maxLength: 64
                  example: America/New_York
                updateMask:
                  type: string
                  description: Fields to update (if empty, all provided fields are applied)
                  format: field-mask
                  example: name,email
                name:
                  type: string
                  description: Display name
                  maxLength: 255
                  example: John Doe
                email:
                  type: string
                  description: Email address
                  maxLength: 254
                  example: user@example.com
                phone:
                  type: string
                  description: Phone number (E.164 format)
                  maxLength: 16
                  example: '+1234567890'
                role:
                  enum:
                  - admin
                  - user
                  - guest
                  type: string
                  description: Authorization role (admin only)
                  example: admin
                status:
                  enum:
                  - pending
                  - active
                  - suspended
                  - deleted
                  type: string
                  description: Account status (admin only)
                  example: pending
                locale:
                  type: string
                  description: Locale (BCP 47)
                  maxLength: 35
                  example: en-US
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/users.v1.User'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      summary: Update user
  /v1/users/{user_id}/avatar:
    delete:
      tags:
      - UserService
      description: Delete user avatar
      operationId: UserService_DeleteAvatar
      parameters:
      - name: user_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
        description: Resource UUID
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      summary: Delete user avatar
  /v1/users/{user_id}/avatar/confirm:
    post:
      tags:
      - UserService
      description: Confirm avatar upload completed
      operationId: UserService_ConfirmAvatarUpload
      parameters:
      - name: user_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
        description: Resource UUID
      summary: Confirm avatar upload completed
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
  /v1/users/{user_id}/avatar/upload-url:
    post:
      tags:
      - UserService
      description: Get presigned URL for avatar upload
      operationId: UserService_GetAvatarUploadUrl
      parameters:
      - name: user_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
        description: Resource UUID
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                contentSize:
                  type: integer
                  description: File size in bytes (1 byte to 10 MB)
                  minimum: 1
                  maximum: 10485760
                  example: 1
                contentType:
                  type: string
                  description: MIME type of the image to upload
                  enum:
                  - image/jpeg
                  - image/png
                  - image/webp
                  example: image/jpeg
              description: Request for presigned upload URL
              required:
              - contentType
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/users.v1.GetAvatarUploadUrlResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
      summary: Get presigned URL for avatar upload
  /v1/users/{user_id}/password:
    put:
      tags:
      - UserService
      description: |-
        Set password (admin only - bypasses current password requirement)
         For user self-service password change, use AuthService.ChangePassword
      operationId: UserService_SetPassword
      parameters:
      - name: user_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
        description: Resource UUID
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  description: 'New password (NIST: min 8 chars, checked against breach databases)'
                  minLength: 8
                  maxLength: 128
                  writeOnly: true
                  example: P@ssw0rd123!
              required:
              - password
        required: true
      responses:
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/rest.v1.ErrorResponse'
        '204':
          description: No Content
      summary: Set password (admin only - bypasses current password requirement)
components:
  schemas:
    auth.v1.AuthResponse:
      type: object
      properties:
        status:
          enum:
          - success
          - mfa_required
          - failed
          - locked
          - suspended
          - pending
          type: string
          description: Status of authentication attempt
          example: success
        tokens:
          allOf:
          - $ref: '#/components/schemas/auth.v1.TokenPair'
          description: Token pair issued on successful authentication
        user:
          allOf:
          - $ref: '#/components/schemas/auth.v1.UserSnapshot'
          description: Authenticated user profile snapshot
        mfaChallenge:
          allOf:
          - $ref: '#/components/schemas/auth.v1.MfaChallenge'
          description: Populated on AUTH_STATUS_MFA_REQUIRED
        lockoutInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.LockoutInfo'
          description: Populated on AUTH_STATUS_LOCKED
        message:
          type: string
          description: Message for user (generic per OWASP - prevent enumeration)
      description: |-
        Authentication result
         Returns tokens on success, or MFA challenge if second factor required
    auth.v1.AuthenticateRequest:
      type: object
      properties:
        identifier:
          type: string
          description: Primary identifier (email or phone)
          minLength: 1
          maxLength: 254
          example: user@example.com
        identifierType:
          enum:
          - email
          - phone
          type: string
          description: Type of identifier
          example: email
        password:
          type: string
          description: 'Password (NIST: min 8 chars, check against breach databases)'
          minLength: 1
          maxLength: 128
          writeOnly: true
          example: P@ssw0rd123!
        installationId:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: Installation ID for immediate session
        clientInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.ClientInfo'
          description: Client info for session
      description: Unified authentication request supporting multiple identifier types
      required:
      - identifier
      - password
      - installationId
      - clientInfo
    auth.v1.ChangePasswordRequest:
      type: object
      properties:
        currentPassword:
          type: string
          description: Current password for verification
          minLength: 1
          writeOnly: true
          example: P@ssw0rd123!
        newPassword:
          type: string
          description: New password
          minLength: 8
          maxLength: 128
          writeOnly: true
          example: N3wP@ssw0rd!456
      description: Change password (requires current password)
      required:
      - currentPassword
      - newPassword
    auth.v1.ClientInfo:
      type: object
      properties:
        deviceId:
          type: string
          description: Unique device/client identifier
          minLength: 1
          maxLength: 255
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        deviceName:
          type: string
          description: Human-readable device name
          maxLength: 255
          example: iPhone 15 Pro
        deviceType:
          type: string
          description: 'Device type: ''mobile'', ''tablet'', ''desktop'', ''web'', ''unknown'''
          maxLength: 50
          example: mobile
        clientVersion:
          type: string
          description: App/client version
          maxLength: 100
          example: 1.0.0
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Additional metadata (`device_model`, `os_info`, fingerprint, etc.)
          example:
            key: value
      description: Client information sent with authentication requests
      required:
      - deviceId
    auth.v1.ConfirmMfaSetupRequest:
      type: object
      properties:
        setupToken:
          type: string
          description: Setup token from `SetupMfaReply`
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
        code:
          type: string
          description: Verification code
          minLength: 6
          maxLength: 8
      description: Confirm MFA setup
      required:
      - setupToken
      - code
    auth.v1.ConfirmMfaSetupResponse:
      type: object
      properties:
        success:
          allOf:
          - $ref: '#/components/schemas/auth.v1.MfaSetupSuccess'
          description: Returned on successful MFA enrollment
        error:
          allOf:
          - $ref: '#/components/schemas/auth.v1.MfaSetupError'
          description: Returned when setup verification fails
      description: MFA setup result
    auth.v1.ConfirmVerificationRequest:
      type: object
      properties:
        token:
          type: string
          description: Verification token from email/SMS
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
        type:
          enum:
          - email
          - phone
          type: string
          description: Type of verification
          example: email
        installationId:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: Installation ID for session creation
        clientInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.ClientInfo'
          description: Client info for session (enables auto-login after verification)
      required:
      - token
      - type
      - installationId
      - clientInfo
    auth.v1.DisableMfaRequest:
      type: object
      properties:
        method:
          enum:
          - totp
          - sms
          - email
          - recovery_code
          type: string
          description: Method to disable (or all if not specified)
          example: totp
        password:
          type: string
          description: |-
            Current password for verification (OWASP: verify identity for sensitive
             ops)
          minLength: 1
          writeOnly: true
          example: P@ssw0rd123!
      description: Disable MFA request
      required:
      - password
    auth.v1.ExchangeOAuthCodeRequest:
      type: object
      properties:
        code:
          type: string
          description: Authorization code from OAuth callback
          minLength: 1
        state:
          type: string
          description: State parameter from callback
          minLength: 1
        installationId:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: Installation ID
        clientInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.ClientInfo'
          description: Client info
      description: Exchange OAuth authorization code
      required:
      - code
      - state
      - installationId
      - clientInfo
    auth.v1.GetMfaStatusResponse:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether MFA is enabled
          example: true
        methods:
          type: array
          items:
            $ref: '#/components/schemas/auth.v1.MfaMethodStatus'
          description: Configured MFA methods
        recoveryCodesRemaining:
          type: integer
          description: Number of unused recovery codes remaining
          format: int32
          example: 0
      description: MFA status for current user
    auth.v1.GetOAuthUrlRequest:
      type: object
      properties:
        provider:
          enum:
          - google
          - github
          - microsoft
          - apple
          - facebook
          type: string
          description: OAuth provider
          example: google
        redirectUri:
          type: string
          description: 'Optional: redirect URI override'
          maxLength: 2048
          example: https://example.com
        scopes:
          type: array
          items:
            type: string
          description: 'Optional: additional scopes'
        stateData:
          type: string
          description: 'Optional: state data to preserve across OAuth flow'
          maxLength: 1024
      description: Get OAuth authorization URL
      required:
      - provider
    auth.v1.GetOAuthUrlResponse:
      type: object
      properties:
        authorizationUrl:
          type: string
          description: Authorization URL to redirect user
          example: https://example.com
        state:
          type: string
          description: State parameter (for CSRF protection)
      description: OAuth URL response
    auth.v1.LinkOAuthProviderRequest:
      type: object
      properties:
        code:
          type: string
          description: Authorization code from OAuth callback
          minLength: 1
        state:
          type: string
          description: State parameter
          minLength: 1
      description: Link OAuth provider to existing account
      required:
      - code
      - state
    auth.v1.LinkedProvider:
      type: object
      properties:
        provider:
          enum:
          - google
          - github
          - microsoft
          - apple
          - facebook
          type: string
          description: OAuth provider type
          example: google
        providerUserId:
          type: string
          description: Provider's external user ID
        email:
          type: string
          description: Email from provider (if available)
          example: user@example.com
        linkedAt:
          type: string
          description: Timestamp when the provider was linked
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
    auth.v1.ListLinkedProvidersResponse:
      type: object
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/auth.v1.LinkedProvider'
          description: List of linked OAuth providers for the current user
      description: Linked OAuth providers response
    auth.v1.ListSessionsRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Active refresh token used to identify the current session
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
      description: Request to list active sessions.
      required:
      - refreshToken
    auth.v1.ListSessionsResponse:
      type: object
      properties:
        sessions:
          type: array
          items:
            $ref: '#/components/schemas/auth.v1.SessionInfo'
          description: Active sessions for the current user
      description: Response for listing sessions
    auth.v1.LockoutInfo:
      type: object
      properties:
        retryAfter:
          pattern: ^-?(?:0|[1-9][0-9]{0,11})(?:\.[0-9]{1,9})?s$
          type: string
          description: Duration until account is unlocked
          example: 300s
        failedAttempts:
          type: integer
          description: Number of failed attempts
          format: int32
          example: 0
        maxAttempts:
          type: integer
          description: Maximum attempts before lockout (configurable)
          format: int32
          example: 0
        lockedUntil:
          type: string
          description: Lockout timestamp
          format: date-time
          example: 2026-01-15T09:30:00Z
      description: Account lockout information
    auth.v1.MfaChallenge:
      type: object
      properties:
        challengeToken:
          type: string
          description: Token to correlate MFA verification with original auth attempt
          example: eyJhbGciOiJIUzI1NiIs...
        availableMethods:
          type: array
          items:
            $ref: '#/components/schemas/auth.v1.MfaMethodInfo'
          description: Available MFA methods for this user
        expiresAt:
          type: string
          description: Challenge expiration - typically 5 minutes
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
      description: MFA challenge - returned when second factor is required
    auth.v1.MfaMethodInfo:
      type: object
      properties:
        method:
          enum:
          - totp
          - sms
          - email
          - recovery_code
          type: string
          description: MFA method type
          example: totp
        hint:
          type: string
          description: Masked hint (e.g., "***-***-1234" for SMS, "john***@gm***.com" for email)
        isDefault:
          type: boolean
          description: True if this is the user's preferred/default method
          example: true
      description: Information about an available MFA method
    auth.v1.MfaMethodStatus:
      type: object
      properties:
        method:
          enum:
          - totp
          - sms
          - email
          - recovery_code
          type: string
          description: MFA method type
          example: totp
        enabled:
          type: boolean
          description: Whether this method is currently active
          example: true
        hint:
          type: string
          description: Masked hint for this method
        configuredAt:
          type: string
          description: When this method was configured
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
      description: Status of a configured MFA method
    auth.v1.MfaSetupError:
      type: object
      properties:
        message:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
    auth.v1.MfaSetupSuccess:
      type: object
      properties:
        recoveryCodes:
          type: array
          items:
            type: string
          description: One-time recovery codes — save securely, each can be used exactly once
      description: Recovery codes (only returned on first MFA enrollment, display once!)
    auth.v1.RecoveryConfirmRequest:
      type: object
      properties:
        token:
          type: string
          description: Recovery token from email/SMS
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
        newPassword:
          type: string
          description: 'New password (NIST: min 8 chars with MFA, min 15 without)'
          minLength: 8
          maxLength: 128
          writeOnly: true
          example: N3wP@ssw0rd!456
      description: Confirm recovery and set new password
      required:
      - token
      - newPassword
    auth.v1.RecoveryStartRequest:
      type: object
      properties:
        identifier:
          type: string
          description: Email or phone number (used to look up account)
          minLength: 1
          maxLength: 254
          example: user@example.com
        identifierType:
          enum:
          - email
          - phone
          type: string
          description: Identifier type (email or phone)
          example: email
        idempotencyKey:
          type: string
          description: |-
            Client-generated idempotency key (UUID v4 recommended).
             Prevents duplicate recovery emails on network retries.
          maxLength: 64
          example: 550e8400-e29b-41d4-a716-446655440000
      description: |-
        Start account recovery (password reset)
         Always returns success to prevent user enumeration (OWASP)
      required:
      - identifier
    auth.v1.RefreshTokensRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Refresh token to exchange for a new token pair
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
      required:
      - refreshToken
    auth.v1.RequestVerificationRequest:
      type: object
      properties:
        type:
          enum:
          - email
          - phone
          type: string
          description: Type of verification
          example: email
      required:
      - type
    auth.v1.RevokeSessionsResponse:
      type: object
      properties:
        revokedCount:
          type: integer
          description: Number of sessions revoked
          format: int32
          example: 0
      description: Response for revoking multiple sessions
    auth.v1.SessionInfo:
      type: object
      properties:
        deviceId:
          type: string
          description: Unique device identifier
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        deviceName:
          type: string
          description: Human-readable device name
          example: iPhone 15 Pro
        deviceType:
          type: string
          description: 'Device type: ''mobile'', ''tablet'', ''desktop'', ''web'', ''unknown'''
          example: mobile
        clientVersion:
          type: string
          description: App version
          example: 1.0.0
        ipAddress:
          type: string
          description: Last seen IP address (may be masked for privacy)
          example: 192.168.1.1
        ipCountry:
          type: string
          description: ISO 3166-1 alpha-2 country code
          example: US
        createdAt:
          type: string
          description: Session creation timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
        lastSeenAt:
          type: string
          description: Last activity timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
        expiresAt:
          type: string
          description: Session expiration timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
        isCurrent:
          type: boolean
          description: True if this is the current session
          example: true
        ipCreatedBy:
          type: string
          description: IP address at session creation
          example: 192.168.1.1
        activityCount:
          type: integer
          description: Number of token refreshes (activity indicator)
          format: int32
          example: 0
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Session metadata (user agent, fingerprint, etc.)
          example:
            key: value
      description: Session information returned to clients
    auth.v1.SetupMfaRequest:
      type: object
      properties:
        method:
          enum:
          - totp
          - sms
          - email
          - recovery_code
          type: string
          description: Method to set up
          example: totp
        identifier:
          type: string
          description: 'For SMS/Email: the phone/email to use (must be verified)'
          maxLength: 254
          example: user@example.com
      description: Request to set up MFA
      required:
      - method
    auth.v1.SetupMfaResponse:
      type: object
      properties:
        secret:
          type: string
          description: 'For TOTP: base32-encoded secret'
        provisioningUri:
          type: string
          description: 'For TOTP: otpauth:// URI for QR code generation'
          example: https://example.com
        maskedDestination:
          type: string
          description: 'For SMS/Email: masked destination where code was sent'
        setupToken:
          type: string
          description: Setup token to correlate with `ConfirmMfaSetup`
          example: eyJhbGciOiJIUzI1NiIs...
        expiresAt:
          type: string
          description: Setup expires at
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
      description: MFA setup response
    rest.v1.ErrorResponse:
      type: object
      required:
      - error
      properties:
        error:
          type: object
          required:
          - code
          - message
          - status
          properties:
            code:
              type: integer
              format: int32
              description: HTTP status code.
            message:
              type: string
              description: Human-readable error message.
            status:
              type: string
              description: gRPC status code name (e.g., INVALID_ARGUMENT).
      description: REST error response envelope.
    auth.v1.SignUpRequest:
      type: object
      properties:
        identifier:
          type: string
          description: User identifier (email or phone in E.164 format)
          minLength: 1
          maxLength: 254
          example: user@example.com
        identifierType:
          enum:
          - email
          - phone
          type: string
          description: Type of identifier (auto-detected if not specified based on format)
          example: email
        password:
          type: string
          description: Password
          minLength: 8
          maxLength: 128
          writeOnly: true
          example: P@ssw0rd123!
        displayName:
          type: string
          description: Display name
          minLength: 1
          maxLength: 255
          example: John Doe
        installationId:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: Unique installation/app instance ID
        clientInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.ClientInfo'
          description: Client/device information for session (stored in sessions table)
        locale:
          type: string
          description: Locale (BCP 47, e.g., `en-US`)
          maxLength: 35
          example: en-US
        timezone:
          type: string
          description: Timezone (IANA, e.g., `America/New_York`)
          maxLength: 64
          example: America/New_York
        idempotencyKey:
          type: string
          description: |-
            Client-generated idempotency key (UUID v4 recommended).
             Guarantees at-most-once execution for retries on network failures.
             Server ignores the request body if a matching key was already processed
             and returns the original response.
          maxLength: 64
          example: 550e8400-e29b-41d4-a716-446655440000
      description: Register a new user account
      required:
      - identifier
      - password
      - displayName
      - installationId
      - clientInfo
    auth.v1.TokenPair:
      type: object
      properties:
        accessToken:
          type: string
          description: Short-lived JWT for authenticating API requests
          example: eyJhbGciOiJIUzI1NiIs...
        refreshToken:
          type: string
          description: Long-lived opaque token used to obtain a new token pair
          example: eyJhbGciOiJIUzI1NiIs...
        expiresAt:
          type: string
          description: Access token expiration timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
    auth.v1.UserSnapshot:
      type: object
      properties:
        userId:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: User's unique identifier
        displayName:
          type: string
          description: Display name
          example: John Doe
        email:
          type: string
          description: Email address
          example: user@example.com
        phone:
          type: string
          description: Phone number (E.164 format)
          example: '+1234567890'
        role:
          enum:
          - admin
          - user
          - guest
          type: string
          description: Authorization role
          example: admin
        status:
          enum:
          - pending
          - active
          - suspended
          - deleted
          type: string
          description: Account status
          example: pending
        emailVerified:
          type: boolean
          description: Whether the email address has been verified
          example: true
        phoneVerified:
          type: boolean
          description: Whether the phone number has been verified
          example: true
        mfaEnabled:
          type: boolean
          description: Whether MFA is enabled for this account
          example: true
        linkedProviders:
          type: array
          items:
            enum:
            - google
            - github
            - microsoft
            - apple
            - facebook
            type: string
          description: Linked OAuth providers
          example:
          - google
        avatarUrl:
          type: string
          description: User's avatar URL
          example: https://example.com
        hasPassword:
          type: boolean
          description: Whether the user has a password set (false for OAuth-only accounts)
          example: true
      description: Info returned on successful auth
    auth.v1.ValidateCredentialsResponse:
      type: object
      properties:
        valid:
          type: boolean
          description: Whether the current session credentials are valid
          example: true
        user:
          allOf:
          - $ref: '#/components/schemas/auth.v1.UserSnapshot'
          description: Authenticated user info (populated when valid is true)
    auth.v1.VerifyMfaRequest:
      type: object
      properties:
        challengeToken:
          type: string
          description: Challenge token from MfaChallenge
          minLength: 1
          example: eyJhbGciOiJIUzI1NiIs...
        method:
          enum:
          - totp
          - sms
          - email
          - recovery_code
          type: string
          description: Method used for verification
          example: totp
        code:
          type: string
          description: Verification code (6-digit TOTP, SMS code, recovery code, etc.)
          minLength: 6
          maxLength: 32
        clientInfo:
          allOf:
          - $ref: '#/components/schemas/auth.v1.ClientInfo'
          description: Client info for session creation
      description: Verify MFA code to complete authentication
      required:
      - challengeToken
      - method
      - code
    users.v1.UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: User's unique identifier
        name:
          type: string
          description: Display name
          example: John Doe
        email:
          type: string
          description: Email address
          example: user@example.com
        phone:
          type: string
          description: Phone number (E.164 format)
          example: '+1234567890'
        role:
          enum:
          - admin
          - user
          - guest
          type: string
          description: Authorization role
          example: admin
        status:
          enum:
          - pending
          - active
          - suspended
          - deleted
          type: string
          description: Account status
          example: pending
        avatarUrl:
          type: string
          description: Avatar image URL
          example: https://example.com
        locale:
          type: string
          description: Locale (BCP 47, e.g., `en-US`)
          example: en-US
        timezone:
          type: string
          description: Timezone (IANA, e.g., `America/New_York`)
          example: America/New_York
    users.v1.User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          pattern: ^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$
          example: 550e8400-e29b-41d4-a716-446655440000
          description: User's unique identifier
        name:
          type: string
          description: Display name
          example: John Doe
        email:
          type: string
          description: Email address
          example: user@example.com
        phone:
          type: string
          description: Phone number (E.164 format)
          example: '+1234567890'
        role:
          enum:
          - admin
          - user
          - guest
          type: string
          description: Authorization role
          example: admin
        status:
          enum:
          - pending
          - active
          - suspended
          - deleted
          type: string
          description: Account status
          example: pending
        emailVerified:
          type: boolean
          description: Whether the email address has been verified
          example: true
        phoneVerified:
          type: boolean
          description: Whether the phone number has been verified
          example: true
        mfaEnabled:
          type: boolean
          description: Whether MFA is enabled for this account
          example: true
        hasPassword:
          type: boolean
          description: Whether the user has a password set (false for OAuth-only accounts)
          example: true
        avatarUrl:
          type: string
          description: Avatar image URL
          example: https://example.com
        locale:
          type: string
          description: Locale (BCP 47, e.g., `en-US`)
          example: en-US
        timezone:
          type: string
          description: Timezone (IANA, e.g., `America/New_York`)
          example: America/New_York
        createdAt:
          type: string
          description: Account creation timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
        updatedAt:
          type: string
          description: Last profile update timestamp
          format: date-time
          readOnly: true
          example: 2026-01-15T09:30:00Z
    users.v1.GetAvatarUploadUrlResponse:
      type: object
      properties:
        uploadUrl:
          type: string
          description: Presigned PUT URL for S3
          example: https://example.com
        expiresIn:
          pattern: ^-?(?:0|[1-9][0-9]{0,11})(?:\.[0-9]{1,9})?s$
          type: string
          description: URL expiration in seconds
          example: 300s
      description: Response with presigned URL for direct S3 upload
    operations.v1.CheckResult:
      type: object
      properties:
        status:
          enum:
          - healthy
          - unhealthy
          type: string
          description: Component health.
          example: healthy
        message:
          type: string
          description: Error detail — present only when status is HEALTH_STATUS_UNHEALTHY.
      description: Individual dependency check result.
    operations.v1.HealthChecks:
      type: object
      properties:
        database:
          allOf:
          - $ref: '#/components/schemas/operations.v1.CheckResult'
          description: Database connectivity check.
        storage:
          allOf:
          - $ref: '#/components/schemas/operations.v1.CheckResult'
          description: |-
            S3 storage connectivity check.
             Omitted from JSON when S3 is not configured.
      description: Component health check results.
    operations.v1.HealthResponse:
      type: object
      properties:
        status:
          enum:
          - healthy
          - unhealthy
          type: string
          description: Overall service health.
          example: healthy
        version:
          type: string
          description: Service version from Cargo.toml (e.g. "0.1.0").
          example: 1.0.0
        checks:
          allOf:
          - $ref: '#/components/schemas/operations.v1.HealthChecks'
          description: Dependency health checks.
      description: Readiness check response with component health.
    users.v1.CreateUserRequest:
      type: object
      properties:
        name:
          type: string
          description: Display name
          minLength: 1
          maxLength: 255
          example: John Doe
        email:
          type: string
          description: Email (optional if phone is provided)
          maxLength: 254
          example: user@example.com
        phone:
          type: string
          description: Phone in E.164 format (optional if email is provided)
          maxLength: 16
          example: '+1234567890'
        password:
          type: string
          description: Password (optional for OAuth-only accounts)
          maxLength: 128
          writeOnly: true
          example: P@ssw0rd123!
        role:
          enum:
          - admin
          - user
          - guest
          type: string
          description: User role
          example: admin
        locale:
          type: string
          description: Locale (BCP 47)
          maxLength: 35
          example: en-US
        timezone:
          type: string
          description: Timezone (IANA)
          maxLength: 64
          example: America/New_York
      required:
      - name
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer authentication token
tags:
- name: AuthService
  description: Auth Service - Authentication, MFA, OAuth, Sessions
- name: OperationsService
  description: Operations Service — REST-only contract for OpenAPI generation
- name: UserService
  description: User Service - User CRUD, avatars, admin functions
servers:
- url: http://localhost:50051
  description: Local development
security:
- bearerAuth: []
